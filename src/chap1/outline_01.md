# 1. React.js(Next.js)の特徴、利点、欠点、TypeScritpt との組み合わせ

現在主流のライブラリ「React.js」とそのフレームワーク「Next.js」について解説します。  
React の特徴、利点、欠点について理解しましょう。  
また、JavaScript のスーパーセットである「TypeScript」について学びましょう。

### 目標

-   React.js がどういう存在か理解する
-   React.js と Next.js の違いについて理解する
-   TypeScript の存在と利点について理解する

### 成果物

TypeScript でコードを書いてみよう。

---

## 講座目的について

### 大学の内容から今回の内容への接続

北海道情報大学では Web コーディングのために HTML/CSS について学ぶ。一方、JavaScript については基本的に生徒の自己学習に任せられ、講義では基礎的な内容にとどまる。  
業務では Web ページよりも Web アプリの構築が多い。Web アプリの構築は HTML/CSS と JavaScript を直接記述するのではなく、ライブラリやフレームワークを利用する。利用するフレームワークは案件によって様々だが、この講座では Next.js について学ぶ。(他には Vue.js や Svelte などがある。他の言語では Laravel や Spring boot が挙げられる。)  
Next.js は HTML に似た記法を利用するフレームワークで、様々な規模の Web アプリに対応でき、Web アプリ構築手段の中で人気が高い。  
HTML の知識を前提として、Next.js の基礎知識を身につけることを目指す。

### なぜ必要なのか

前述の通り、Next.js は様々な規模の Web アプリに対応できる上、サーバ側の機能も充実しているため人気が高い。  
近年のフロントエンドの技術において必須級となっており、基本を習得するだけでも卒業研究に活かせ、就職後も役に立つ。

### 講座の進め方

この講座での git 操作は CLI(ターミナル)で行う。VSCode や SourceTree など他での操作に慣れている場合はそちらを使ってもよい。

まずはこの講座の資料リポジトリを手元に clone する。

```bash
cd path/path

git clone https://github.com/2021233/ModernFrontendEntry_HIU
```

次に各自の branch を作成する。`git checkout`はブランチ作成とチェックアウト(ブランチ移動)を一気に行う。  
branch 名は判別できるものをつける。

```bash
git checkout -b branch名
```

作成したブランチをリモートリポジトリに反映する。

```bash
git push -u origin branch名
```

各回のメモはテキスト形式(`.txt`)または Markdown 形式(`.md`)で作成することを推奨。  
各回の資料を書き換えてもよい。

```bash
git add ./
git commit -m "update memo"

# 上の操作を一気に行う
git commit -am "update memo"

# リモートリポジトリにアップロード
git push
```

## 前提知識・準備物

この講座は以下の知識があることを前提に進める。

-   タグやプロパティや DOM 操作などの HTML/CSS,JavaScript の知識
-   ファイルやディレクトリなどのコンピュータの基礎知識
-   URL やクライアントサーバモデルなどのインターネットの基礎知識
-   変数、定数、配列、オブジェクト、関数、引数、返り値などのプログラミングの基礎知識
-   Git の add、commit 操作、GitHub への push を事前に学習しておくこと

また、この講座は以下のものを必須とする。

-   PC(タブレット不可、Chromebook 非推奨)
-   GitHub アカウント：個人のものが望ましい。Repository は講座内で作成する。
-   Figma アカウント：個人のもの

---

## React.js とは

Next.js は React.js をベースとしたフレームワークであるため、先に React.js について解説する。

React は JavaScript の宣言型 UI ライブラリ。ページ内の要素の塊を「コンポーネント」(部品)に分けることで、部品を再利用でき効率的に開発ができることが特徴。基本は Web アプリの構築に用いられるが、大規模な Web ページの構築にも用いられる。  
React 単体では含まれていない機能があったり機能が十分ではない場合があったりするため、ほとんどの場合は他の周辺ライブラリと併せて使われる。  
主に以下の機能を導入、または強化するために周辺ライブラリを導入する。

-   ルーティング：ページ遷移のこと。標準では機能が少なく実装が複雑になる。
-   状態管理：アプリケーション内で値を管理すること。標準では対応できない規模で導入する。
-   UI コンポーネント：ボタンやアイコンなどの部品集のこと。複雑な実装をしなくても見栄えのする画面が作れる。
-   フォーム：複雑になりがちなフォームの実装を簡単に済ませることができ、パフォーマンスも良い。
    特にルーティングと UI コンポーネントのライブラリを導入することが多い。

### 宣言型 UI ライブラリとはどういうことか

例えるならば、TV を点けたいときに直接回路を操作するのが命令形、リモコンの電源ボタンを押すのが宣言型である。「こうしなさい」と命令するのが命令型、「こうしたい」と宣言するのが宣言型のイメージ。  
例えば、「要素を作成して各属性を設定し、この要素の何番目の子要素として挿入する」という操作を行うものは命令型と呼ばれる。  
一方、React は上と同じ操作を以下のように記述できる。

```
<div>
  <a href="https://example.com" className="btn_link">
</div>
```

「何の要素を作るか」「作った要素の属性に何を設定するか」「どの位置に要素を入れるか」といった情報を、書き方で表現できるのが宣言型 UI ライブラリである。  
宣言型の記述は期待する結果をそのまま表現するため、可読性が高く記述が簡単である。

## Next.js とは

React に様々な周辺機能を追加したフレームワーク。  
React がゲームソフトだとすると、Next はゲーム機本体とソフトのセットにあたるイメージ。  
App Router というページ遷移機能によってディレクトリ構成から自動で URL を生成でき、やサーバー機能などが標準に加わっている。  
React が UI の構築のみを行うのに対して、Next.js は Web アプリ構築の全体をサポートする。

## React.js と Next.js の違い

宣言的 UI ライブラリである React に機能を加えたのが Next である。  
Next は大抵の場合必要になる機能が搭載されているが、使わなかったり他の類似ライブラリを導入した場合は余計な容量を使ってしまうことになる。  
React は単体での役割は少ないが軽量かつ柔軟でカスタマイズ性が高く、Next は単体での役割は豊富だが各機能を理解して使いこなす必要がある。

## TypeScript とは

JavaScript に型システムを追加した、JavaScript と互換性のある言語。TypeScript で書いたコードを JavaScript に変換(トランスパイル)して使うことが多いが、最近では TypeScript のまま使われることもある。  
型システムによって安全なプログラムを作ることができるため、React と併せて用いられることが多い。  
TypeScript のように元の言語との互換性を保って機能を拡張した言語を「スーパーセット」とよぶ。

### 型の書き方

TypeScritp では値に指定した型を「型注釈」とよぶ。

#### 基本的な型(プリミティブ型)

基本的な型はプリミティブ型とよぶ。  
プリミティブ型は以下の通り記述する。

-   `number`：数字型
-   `string`：文字列型
-   `boolean`：真偽型
-   `null`： null(値がないことの表現)
-   `undefined`： undefined(変数やプロパティが存在しない)
-   `void`：返り値なし(関数の返り値にのみ使う)
-   `any`：すべての型を許容する
-   `unknown`：他の型を許容しない不明な型

他に`bigint`と`symbol`があるが、使用頻度は低い。

#### オブジェクト

オブジェクトは以下の通り記述する。

```
{
    key0: Type;
    key1: Type;
    key2: Type;
}
```

`Type`に指定する型はプリミティブ型、オブジェクト型、配列型、その他どのような型でもよい。  
オブジェクトは最も恩恵が大きい型注釈のひとつ。

#### 配列

配列は以下の通り記述する。

-   `Type[]`
-   `Array<T>`
    例えば、`number`の配列は`number[]`または`Array<number>`と記述できる。  
    配列に指定する型はプリミティブ型、オブジェクト型、配列型、その他どのような型でもよい。
    JavaScript において配列は内部的にはオブジェクトだが、扱いは異なる。

#### 複数の型いずれかを示すユニオン型

例えば`number`と`string`のどちらの可能性もある場合は以下の通り`|`を用いて記述する。

```
number | string
```

型の候補はいくつでも可能。  
型の候補のどれかが配列の場合は以下の通り記述する。

```
number | string[] | boolean
```

型の候補のすべてが配列の場合は以下の通りに記述できる。

```
(number | boolean)[]
```

#### null 可能性・undefined 可能性

`null`または`undefined`の可能性がある場合は以下のように記述する。

```
boolean | null
string | undefined
```

オブジェクトのプロパティが`undefined`の可能性がある場合は以下のように記述することができる。

```
{
    message?: string;
}
```

#### リテラル型

プリミティブ型の特定の値を型として扱うことができる。  
リテラル型で指定した値以外を扱うことができない。

```
let label: "title";
```

この変数`label`には、たとえ`string`型でも`"title"`という値以外入れることができない。

リテラル型はいくつかのキーワードが決まっている場合に使われることがある。

```
let
```

#### 型に名前を付ける型エイリアス

定数に値を入れて定数名を付けるように、型に名前を付けてプリミティブ型のように使うことができる。  
型に名前を付けるには`type`キーワードを使う。

```
type user = {
    id: number;
    name: string;
    name_ruby: string;
    age: number;
    gender: "M" | "F";
    nationality: Country;
    address: string;
    language: Language;
    status: "unlimited" | "pro" | "free" | "family";
    family_account?: number[];
}
```

`Country`、`Language`は他の型エイリアス。

#### 関数型

関数にはアロー関数という記法がある。関数型はアロー関数の記法を踏襲している。

```
(引数名: type, 引数名: type,...) => type
```

引数がなければ省略できる。

```
() => type
```

返り値がない場合は`void`を指定する。

```
(引数名: type) => void
```

関数型は React.js と TypeScript の組み合わせではよく使う。

#### ライブラリの型

例えば、ライブラリが提供する関数の引数や返り値などがオブジェクトである場合、利用者側で型を定義するのは難しい。  
ライブラリで使う値の型はパッケージとして配布されている。型のパッケージから型エイリアスを読み込んで使うことができる。

## TypeScript のサンプル

ここからは TypeScript のサンプルコードを作成して動かしてみる。

### node.js のインストール

まずは TypeScript を利用するために必須のソフトウェアをインストールする。
Windows でのインストールは[これ](https://mikaduki.info/dev-env/win-install-node-npm/)を参考に進める。  
macOS でのインストールは[これ](https://zenn.dev/tn_a/articles/2487073812cb12)を参考に進める。  
Linux でのインストールは[これ](https://ja.linux-terminal.com/?p=4411)を参考に進める。

node.js と同時に NPM もインストールされる。以下のコマンドでインストールが成功しているか確認する。

```
node -v
npm -v
```

バージョン情報が表示されなければインストールできていないため再度インストール手順を試す。

### TypeScript を書く準備

TypeScript と実行ソフトウェアを NPM を使ってインストールする。  
cloneした講座ディレクトリ内の`src/chap1`に移動する。

```
# ディレクトリを移動
cd src/chap1
```

`src/chap1`に TypeScript をインストールする。

```
npm install typescript
```

作成したディレクトリをエディタで開く。

### サンプルコードの概要と要件

関数を 1 つ作り、異なるファイル内で引数を変えて呼び出すコードを作成する。そのため、今回作成するのは次の 2 つのファイルとなる。

-   関数を記述するファイル
-   関数を呼び出して使うファイル

#### 関数の要件

複数の商品情報を受け取り以下を出力する。

-   「yyyy/mm/dd hh:mm」形式の実行した年月日時分
-   「商品名 - 税込金額(税)」形式のリスト
-   「合計金額(税)」

出力は関数内で行い、`console.log`を使う。

なお、リストは受け取った商品情報の順のままとする。  
出力形式は任意とする。

商品情報は以下のプロパティを持つオブジェクトの配列である。

-   `name`: 商品名
-   `price`: 税抜金額
-   `quantity`: 購入数

全ての金額は小数点第 1 位で四捨五入すること。  
また、予期しない値を渡した場合はエラーとなること。(エラー表示を実装してもよい)

#### 関数の実行の仕方

作った関数を実行するにはTypeScriptファイルをJavaScriptファイルに変換する必要がある。

```bash
# macOS, Linux
./node_modules/typescript/bin/tsc function.ts sample.ts

# windows
npx tsc function.ts sample.ts
```

エラーがなければなにも出力されない。  
完了すると同じ名前でJavaScriptファイルが作られる。上の例のように`function.ts`と`sample.ts`を変換した場合は`function.js`と`sample.js`が作られる。

JavaScriptファイルの実行は`node`コマンドを使用する。

```bash
node sample.js
```

これで要件通りの出力ができるか確認する。

